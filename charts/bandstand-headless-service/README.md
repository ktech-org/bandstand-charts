# Bandstand Service

## Global values

| Key                | Type   | Default | Description                                           |
|--------------------|--------|---------|-------------------------------------------------------|
| global.aws.account | string |         | The AWS account the helm chart is installed into      |
| global.env         | string |         | The environment, either test, preprod or prod         |
| global.image.tag   | string |         | The tag for container image to be used in the service |

## Values

| Key                                 | Type   | Default                                | Description                                                                                                                                                                                                                                                                                         |
|-------------------------------------|--------|----------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| additionalEnvVars                   | object | `{}`                                   | An object containing additional environment variables                                                                                                                                                                                                                                               |
| environmentEnvVars                  | object | `{}`                                   | An object containing environment specific additional environment variables                                                                                                                                                                                                                          |
| dockerRegistry                      | string | `ktechartifacts-docker.jfrog.io`       | Docker registry to pull images from                                                                                                                                                                                                                                                                 |
| enforceCpuLimits                    | bool   |                                        | By default CPU will burst to use spare capacity on the node. Setting this flag will add a cpu limit with the same value as `resources.requests.cpu`. It is recommended to set this flag in performance testing environments to ensure recorded performance isn't based on unallocated capacity      |
| envFrom                             | object | `{}`                                   | References to ConfigMaps / Secrets which will be mapped to environment variables. For more details see [here](https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#configure-all-key-value-pairs-in-a-configmap-as-container-environment-variables)                    |
| gitRepo                             | string | `.Release.Name`                        | The name of the repository for the service                                                                                                                                                                                                                                                          |
| hpa.averageCpuUtilization           | int    | `50`                                   | Horizontal pod autoscaler, the threshold average CPU ultilization to trigger, see [here](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)                                                                                                                                |
| hpa.maxReplicas                     | int    | `3`                                    | Horizontal pod autoscaler, maximum number of pods, see [here](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)                                                                                                                                                           |
| hpa.minReplicas                     | int    | `1`                                    | Horizontal pod autoscaler, minimum number of pods, see [here](https://kubernetes.io/docs/tasks/run-application/horizontal-pod-autoscale/)                                                                                                                                                           |
| imageName                           | string | `.Release.Name "-" .Values.nameSuffix` | Name of the docker image to run                                                                                                                                                                                                                                                                     |
| imagePullSecret                     | string | `rt-docker-config`                     | Docker registry secret for pulling image                                                                                                                                                                                                                                                            |
| livenessProbe                       | object | `{}`                                   | Liveness probe definiton, for more details see [k8s docs](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)                                                                                                                                    |
| nameSuffix                          | string |                                        | A suffix to be appended to the name of all created resources. This is useful when using subcharts to define multiple services within a single helm release                                                                                                                                          |
| owner                               | string |                                        | The GitHub team that owns the service                                                                                                                                                                                                                                                               |
| config                              | object | `{}`                                   | An object containing base config for the service - use this for creating base config files.                                                                                                                                                                                                         |
| envConfig                           | object | `{}`                                   | An object containing environment config for the service - use this for creating environment specific config files.                                                                                                                                                                                  |
| resources.requests.cpu              | string | `100m`                                 | [Requests](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits) for container CPU resources measured in cpu units, one core is 1000m, see [here](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-cpu)      |
| resources.requests.memory           | string | `512Mi`                                | Container memory [Requests and Limit](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits)see [here](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-memory) (both set to the same value)                  |
| resources.requests.ephemeralStorage | string | `64Mi`                                 | Container ephemeral storage [Requests and Limit](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits)see [here](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#local-ephemeral-storage) (both set to the same value) |
| runAsUser                           | number | 1000                                   | The user id to run the container as (cannot be 0/root)                                                                                                                                                                                                                                              |
| startupProbe                        | object | `{}`                                   | Liveness probe definiton, for more details see [k8s docs](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)                                                                                                                                    |
| secrets                             | list   | `[]`                                   | List of secrets manager secrets to add to the pod (via External Secrets). For details of each entries attributes see below. See [the handbook](https://engineering-handbook.ktech.com/core-infrastructure/bandstand/development/secrets/) for usage examples.                                       |
| secrets[].name                      | string |                                        | The name of the entry, will be used as part of the secret name.                                                                                                                                                                                                                                     |
| secrets[].secret                    | string |                                        | The name of the secrets manager secret to sync.                                                                                                                                                                                                                                                     |
| secrets[].prefix                    | string |                                        | An optional prefix added to all envvar names coming from this secret.                                                                                                                                                                                                                               |
| secrets[].optional                  | bool   | `false`                                | Flag to indicate if adding this secret to the env is optional or not. If this is set to `false` (the default) and the secret fails to sync due to a misconfiguration or missing secret value, then the pods won't attempt to start.                                                                 |
| serverContainer.arguments           | list   |                                        | Override the default container (Helm) arguments (this is the docker CMD) for the service Pod                                                                                                                                                                                                        |
| serverContainer.command             | string |                                        | Override the default container (Helm) command (this is the docker ENTRYPOINT) for the service Pod                                                                                                                                                                                                   |
| systemCode                          | string | `.Release.Name`                        | The systemCode for the service                                                                                                                                                                                                                                                                      |
| systemGroup                         | string |                                        | The systemGroup for the service                                                                                                                                                                                                                                                                     |

| volume.persistent                   | string |                                   | Adds a persistent volume of the amount set, e.g. 1G                                                                                                                                                                                                                                                                             |
| volume.ephemeral                      | string |                             | Size of ephemeral storage, e.g. 10G mounted at /tmp standard emptyfile tmp directory added if not set.                                                                                                                                                                                                                                                                            |
