{{- $relName := .Release.Name -}}
{{- range .Values.secrets }}
{{- $secretName = compact list $.Release.Name $.Values.nameSuffix .prefix | join "-" }}
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: $secretName-{{ randAlphaNum 5 | quote }} # The name to use in the Helm chart
  annotations:
    force-sync: '{{ now | unixEpoch }}'
spec:
  secretStoreRef:
    name: cluster-store
    kind: ClusterSecretStore
  target: {}
  dataFrom:
    - extract:
        key: {{ .secret }}
{{- end }}
