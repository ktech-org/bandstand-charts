suite: bandstand-web-service additional tests
set:
  global.image.tag: latest
  global.aws.account: 1234567890
tests:
  # Service Account Tests
  - it: should create a service account with the correct name
    values:
      - ./default-values.yaml
    template: serviceaccount.yaml
    asserts:
      - containsDocument:
          kind: ServiceAccount
          apiVersion: v1
          name: RELEASE-NAME

  - it: should be annotated with the correct IAM role
    values:
      - ./default-values.yaml
    set:
      global.aws.account: ACCOUNT-ID
    template: serviceaccount.yaml
    asserts:
      - equal:
          path: metadata.annotations['eks.amazonaws.com/role-arn']
          value: 'arn:aws:iam::ACCOUNT-ID:role/RELEASE-NAME'
