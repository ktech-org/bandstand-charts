# Bandstand job

## Global values

| Key                | Type   | Default | Description                                           |
|--------------------|--------|---------|-------------------------------------------------------|
| global.aws.account | string |         | The AWS account the helm chart is installed into      |
| global.env         | string |         | The environment, either test, preprod or prod         |
| global.image.tag   | string |         | The tag for container image to be used in the service |

## Values

| Key                                 | Type   | Default                          | Description                                                                                                                                                                                                                                                                                           |
|-------------------------------------|--------|----------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| additionalEnvVars                   | object | `{}`                             | An object containing additional environment. Use these in the values.yaml file. variables                                                                                                                                                                                                             |
| environmentEnvVars                  | object | `{}`                             | An object containing environment specific additional environment variables. Use this in *-values.yaml files to not overwrite the additionalEnvVars object                                                                                                                                             |
| dockerRegistry                      | string | `ktechartifacts-docker.jfrog.io` | Docker registry to pull images from                                                                                                                                                                                                                                                                   |
| enforceCpuLimits                    | bool   |                                  | By default CPU will burst to use spare capacity on the node. Setting this flag will add a cpu limit with the same value as `resources.requests.cpu`. It is recommended to set this flag in performance testing environments to ensure recorded performance isn't based on unallocated capacity        |
| envFrom                             | object | `{}`                             | References to ConfigMaps / Secrets which will be mapped to environment variables. For more details see [here](https://kubernetes.io/docs/tasks/configure-pod-container/configure-pod-configmap/#configure-all-key-value-pairs-in-a-configmap-as-container-environment-variables)                      |
| imageName                           | string | `.Release.Name`                  | Name of the docker image to run                                                                                                                                                                                                                                                                       |
| imagePullSecret                     | string | `rt-docker-config`               | Docker registry secret for pulling image                                                                                                                                                                                                                                                              |
| jobContainer.arguments              | list   |                                  | Override the default container arguments for the job Pod                                                                                                                                                                                                                                              |
| jobContainer.command                | string |                                  | Override the default container command for the job Pod                                                                                                                                                                                                                                                |
| config                              | object | `{}`                             | An object containing base config for the service - use this for creating base config files.                                                                                                                                                                                                           |
| envConfig                           | object | `{}`                             | An object containing environment config for the service - use this for creating environment specific config files.                                                                                                                                                                                    |
| resources.requests.cpu              | string | `100m`                           | [Requests](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits) for container CPU resources measured in cpu units, one core is 1000m, see [here](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-cpu)        |
| resources.requests.memory           | string | `256Mi`                          | Container memory [Requests and Limit](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits) see [here](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-memory) (both set to the same value)                   |
| resources.requests.ephemeralStorage | string | `64Mi`                           | Container ephemeral storage [Requests and Limit](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#requests-and-limits) see [here](https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#local-ephemeral-storage) (both set to the same value)  |
| secrets                             | list   | `[]`                             | List of secrets manager secrets to add to the pod (via External Secrets). For details of each entries attributes see below. See [the handbook](https://engineering-handbook.ktech.com/core-infrastructure/bandstand/development/secrets/) for usage examples.                                         |
| secrets[].name                      | string |                                  | The name of the entry, will be used as part of the secret name.                                                                                                                                                                                                                                       |
| secrets[].secret                    | string |                                  | The name of the secrets manager secret to sync. Note this field can include references to other values e.g. `{{.Values.global.env}}`                                                                                                                                                                  |
| secrets[].prefix                    | string |                                  | An optional prefix added to all envvar names coming from this secret.                                                                                                                                                                                                                                 |
| secrets[].optional                  | bool   | `false`                          | Flag to indicate if adding this secret to the env is optional or not. If this is set to `false` (the default) and the secret fails to sync due to a misconfiguration or missing secret value, then the pods won't attempt to start.                                                                   |
| secrets[].upperCaseKeys             | bool   | `false`                          | Flag to indicate if keys should be transformed to be upper case.                                                                                                                                                                                                                                      |
| backoffLimit                        | number | `0`                              | [Back off limit](https://kubernetes.io/docs/concepts/workloads/controllers/job/#pod-backoff-failure-policy) To enable auto-restart on failure set to a value > 0                                                                                                                                      |
| volume.persistent                   | string |                                  | Adds a persistent volume of the amount set, e.g. 1G                                                                                                                                                                                                                                                   |
| volume.ephemeral                    | string |                                  | Size of ephemeral storage, e.g. 10G mounted at /tmp standard emptyfile tmp directory added if not set.                                                                                                                                                                                                |
| volume.storageClass                 | string | `general-storage`                | Storage class to use for both persistent and ephemeral volumes, choose from `general-storage`, `gp3-iops-5k`, `gp3-iops-10k`                                                                                                                                                                          |
| ttlSecondsAfterFinished             | number | 60 (1 minute)                    | How long to keep a Job around for after it has completed                                                                                                                                                                                                                                              |
